{
  "queries": [
    {
      "name": "mes_order_status",
      "description": "MES工單應結未結清單",
      "target_table": "tableau_mes_order_status",
      "sql": "SELECT [MANUFACTURING_OD] [工單號] \n   ,[MATERIAL][料號]\n   ,[MATERIAL_DESC][料號名稱]\n   ,[QTY][工單預計生產數量]  　　\n   ,[PLANNED_S_DATE][工單預計開工日] \n   ,[PLANNED_C_DATE][工單預計完工日] \n   ,[QTY_DONE][工單實際完工數量]\n   ,[QTY_DONE] - [QTY] [實際完工量-預計生產量]\n   ,[ACTUAL_S_DATE][工單實際開工日]\n   ,[ACTUAL_C_DATE][工單實際完工日] \n   ,CASE \n       WHEN [SHOP_ORD_STATUS] =1   THEN '已核 '\n       WHEN [SHOP_ORD_STATUS] =2   THEN '生管已派'\n       WHEN [SHOP_ORD_STATUS] =3   THEN '加工中'\n       WHEN [SHOP_ORD_STATUS] =9   THEN '完成'\n       WHEN [SHOP_ORD_STATUS] =10   THEN 'SAP已核'\n       WHEN [SHOP_ORD_STATUS] =12   THEN '已結'\n       WHEN [SHOP_ORD_STATUS] =13   THEN '製造已派'\n   END [MES工單狀態]\n   ,CASE\n       WHEN [SAP_ORD_STATUS] = 'P'   THEN '已計畫'\n       WHEN [SAP_ORD_STATUS] = 'R'   THEN '已核發'\n       WHEN [SAP_ORD_STATUS] = 'C'   THEN '已取消'\n       WHEN [SAP_ORD_STATUS] = 'L'   THEN '已結'\n   END [SAP工單狀態]\n   ,DATEDIFF(dd, [PLANNED_C_DATE],[ACTUAL_C_DATE]) [實際完工日-預計完工日] \n   ,CASE \n    WHEN DATEDIFF(dd, [PLANNED_C_DATE],[ACTUAL_C_DATE]) > 0   THEN '延遲'\n    WHEN DATEDIFF(dd, [PLANNED_C_DATE],[ACTUAL_C_DATE]) = 0   THEN '如期'\n  　WHEN DATEDIFF(dd, [PLANNED_C_DATE],[ACTUAL_C_DATE]) < 0   THEN '提前'\n    ELSE  ' ' \n END　[工單狀態]\nFROM [yesiang-MES-AP_New].[dbo].[MANUFACTURING_NO]"
    },
    {
      "name": "mes_material_loss",
      "description": "MES損耗差異分析",
      "target_table": "tableau_mes_material_loss",
      "sql": "WITH FeedMaterial AS (\n    SELECT \n        PLANT,\n        MANUFACTURING_OD,\n        MATERIAL,\n        OPERATION,\n        SUM(IN_QTY) AS TOTAL_IN_QTY\n    FROM \n        FEED_MATERIAL_DEVICE\n    GROUP BY \n        PLANT,\n        MANUFACTURING_OD,\n        MATERIAL,\n        OPERATION\n)\nSELECT \n    mn.[MANUFACTURING_OD] AS [工單號],\n    mn.[MATERIAL] AS [料號],\n    mn.[MATERIAL_DESC] AS [料號名稱],\n    mn.[QTY] AS [工單預計生產數量],\n    mn.[PLANNED_S_DATE] AS [工單預計開工日],\n    mn.[PLANNED_C_DATE] AS [工單預計完工日],\n    mn.[QTY_DONE] AS [工單實際完工數量],\n mn.[QTY_DONE] - mn.[QTY] AS [實際完工量-預計生產量],\n    mn.[ACTUAL_S_DATE] AS [工單實際開工日],\n    mn.[ACTUAL_C_DATE] AS [工單實際完工日],\n    CASE     \n        WHEN mn.[SHOP_ORD_STATUS] = 1 THEN '已核'    \n        WHEN mn.[SHOP_ORD_STATUS] = 2 THEN '生管已派'    \n        WHEN mn.[SHOP_ORD_STATUS] = 3 THEN '加工中'    \n        WHEN mn.[SHOP_ORD_STATUS] = 9 THEN '完成'    \n        WHEN mn.[SHOP_ORD_STATUS] = 10 THEN 'SAP已核'    \n        WHEN mn.[SHOP_ORD_STATUS] = 12 THEN '已結'    \n        WHEN mn.[SHOP_ORD_STATUS] = 13 THEN '製造已派'    \n    END AS [MES工單狀態],    \n    CASE    \n        WHEN mn.[SAP_ORD_STATUS] = 'P' THEN '已計畫'    \n        WHEN mn.[SAP_ORD_STATUS] = 'R' THEN '已核發'    \n        WHEN mn.[SAP_ORD_STATUS] = 'C' THEN '已取消'    \n        WHEN mn.[SAP_ORD_STATUS] = 'L' THEN '已結'    \n    END AS [SAP工單狀態],\n op.SAP_OPERATION_GP [SAP 工站代號],\n CASE    \n        WHEN op.[SAP_OPERATION_GP] = '201' THEN '攪料'    \n        WHEN op.[SAP_OPERATION_GP] = '202' THEN '碳線'    \n        WHEN op.[SAP_OPERATION_GP] = '203' THEN '打摺'    \n        WHEN op.[SAP_OPERATION_GP] = '204' THEN '貼邊'    \n  WHEN op.[SAP_OPERATION_GP] = '205' THEN '組框'\n  WHEN op.[SAP_OPERATION_GP] = '206' THEN '組裝'\n  WHEN op.[SAP_OPERATION_GP] = '207' THEN '包裝'\n  WHEN op.[SAP_OPERATION_GP] = '101' THEN '填充'\n  WHEN op.[SAP_OPERATION_GP] = '104' THEN '包裝'\n    END AS [SAP 工站名稱],\n bc.COMPONENT AS [SAP BOM 領用料號],\n bc.QTY AS [SAP BOM 標準用量],\n NULL [SAP BOM 實際領用量],\n NULL [SAP工單實際領用量-SAP BOM標準用量],\n NULL [SAP損耗率],\n bc.ASSY_OP [MES工站代號],\n op.OPERATION [MES工站名稱],\n    fm.TOTAL_IN_QTY AS [MES 工單 領用數量],\n fm.TOTAL_IN_QTY - bc.QTY AS [MES工單領用數量-SAP BOM標準數量],\n (fm.TOTAL_IN_QTY - bc.QTY) / bc.QTY * 100 [損耗率% (MES實際-SAP標準)]\n\nFROM \n    [yesiang-MES-AP_New].[dbo].[MANUFACTURING_NO] mn\nLEFT JOIN \n    FeedMaterial fm\nON \n    mn.[MANUFACTURING_OD] = fm.[MANUFACTURING_OD]\nLEFT JOIN \n    [BOM_COMPONENT] bc\nON \n    mn.[MANUFACTURING_OD] = bc.[BOM]\n    AND mn.[PLANT] = bc.[PLANT]\n   AND fm.[MATERIAL] = bc.[COMPONENT]\nLEFT JOIN \n    [OPERATION] op\nON \n    bc.ASSY_OP = op.operation"
    }
  ]
}
